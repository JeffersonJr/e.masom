"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(middleware)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(middleware)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @auth/drizzle-adapter */ \"(middleware)/./node_modules/@auth/drizzle-adapter/index.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/db */ \"(middleware)/./src/lib/db/index.ts\");\n/* harmony import */ var _lib_db_schema__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/db/schema */ \"(middleware)/./src/lib/db/schema.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(middleware)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! bcryptjs */ \"(middleware)/./node_modules/bcryptjs/dist/bcrypt.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_5__);\n\n\n\n\n\n\n\nconst { handlers, signIn, signOut, auth } = (0,next_auth__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n    adapter: (0,_auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_2__.DrizzleAdapter)(_lib_db__WEBPACK_IMPORTED_MODULE_3__.db),\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Senha\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                const user = await _lib_db__WEBPACK_IMPORTED_MODULE_3__.db.select().from(_lib_db_schema__WEBPACK_IMPORTED_MODULE_4__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_lib_db_schema__WEBPACK_IMPORTED_MODULE_4__.users.email, credentials.email)).limit(1);\n                if (!user.length) {\n                    return null;\n                }\n                const isValidPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_5___default().compare(credentials.password, user[0].password);\n                if (!isValidPassword) {\n                    return null;\n                }\n                if (!user[0].isActive) {\n                    return null;\n                }\n                return {\n                    id: user[0].id,\n                    email: user[0].email,\n                    name: user[0].name,\n                    degree: user[0].degree,\n                    position: user[0].position\n                };\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.degree = user.degree;\n                token.position = user.position;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token) {\n                session.user.id = token.sub;\n                session.user.degree = token.degree;\n                session.user.position = token.position;\n            }\n            return session;\n        }\n    },\n    pages: {\n        signIn: \"/login\",\n        error: \"/auth/error\"\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9hdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFnQztBQUN5QjtBQUNIO0FBQ3pCO0FBQ1U7QUFDUDtBQUNIO0FBRXRCLE1BQU0sRUFBRU8sUUFBUSxFQUFFQyxNQUFNLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxFQUFFLEdBQUdWLHFEQUFRQSxDQUFDO0lBQzFEVyxTQUFTVCxxRUFBY0EsQ0FBQ0MsdUNBQUVBO0lBQzFCUyxXQUFXO1FBQ1RYLDJFQUFXQSxDQUFDO1lBQ1ZZLGFBQWE7Z0JBQ1hDLE9BQU87b0JBQUVDLE9BQU87b0JBQVNDLE1BQU07Z0JBQVE7Z0JBQ3ZDQyxVQUFVO29CQUFFRixPQUFPO29CQUFTQyxNQUFNO2dCQUFXO1lBQy9DO1lBQ0EsTUFBTUUsV0FBVUwsV0FBVztnQkFDekIsSUFBSSxDQUFDQSxhQUFhQyxTQUFTLENBQUNELGFBQWFJLFVBQVU7b0JBQ2pELE9BQU87Z0JBQ1Q7Z0JBRUEsTUFBTUUsT0FBTyxNQUFNaEIsdUNBQUVBLENBQ2xCaUIsTUFBTSxHQUNOQyxJQUFJLENBQUNqQixpREFBS0EsRUFDVmtCLEtBQUssQ0FBQ2pCLCtDQUFFQSxDQUFDRCxpREFBS0EsQ0FBQ1UsS0FBSyxFQUFFRCxZQUFZQyxLQUFLLEdBQ3ZDUyxLQUFLLENBQUM7Z0JBRVQsSUFBSSxDQUFDSixLQUFLSyxNQUFNLEVBQUU7b0JBQ2hCLE9BQU87Z0JBQ1Q7Z0JBRUEsTUFBTUMsa0JBQWtCLE1BQU1uQix1REFBYyxDQUMxQ08sWUFBWUksUUFBUSxFQUNwQkUsSUFBSSxDQUFDLEVBQUUsQ0FBQ0YsUUFBUTtnQkFHbEIsSUFBSSxDQUFDUSxpQkFBaUI7b0JBQ3BCLE9BQU87Z0JBQ1Q7Z0JBRUEsSUFBSSxDQUFDTixJQUFJLENBQUMsRUFBRSxDQUFDUSxRQUFRLEVBQUU7b0JBQ3JCLE9BQU87Z0JBQ1Q7Z0JBRUEsT0FBTztvQkFDTEMsSUFBSVQsSUFBSSxDQUFDLEVBQUUsQ0FBQ1MsRUFBRTtvQkFDZGQsT0FBT0ssSUFBSSxDQUFDLEVBQUUsQ0FBQ0wsS0FBSztvQkFDcEJlLE1BQU1WLElBQUksQ0FBQyxFQUFFLENBQUNVLElBQUk7b0JBQ2xCQyxRQUFRWCxJQUFJLENBQUMsRUFBRSxDQUFDVyxNQUFNO29CQUN0QkMsVUFBVVosSUFBSSxDQUFDLEVBQUUsQ0FBQ1ksUUFBUTtnQkFDNUI7WUFDRjtRQUNGO0tBQ0Q7SUFDREMsU0FBUztRQUNQQyxVQUFVO0lBQ1o7SUFDQUMsV0FBVztRQUNULE1BQU1DLEtBQUksRUFBRUMsS0FBSyxFQUFFakIsSUFBSSxFQUFFO1lBQ3ZCLElBQUlBLE1BQU07Z0JBQ1JpQixNQUFNTixNQUFNLEdBQUdYLEtBQUtXLE1BQU07Z0JBQzFCTSxNQUFNTCxRQUFRLEdBQUdaLEtBQUtZLFFBQVE7WUFDaEM7WUFDQSxPQUFPSztRQUNUO1FBQ0EsTUFBTUosU0FBUSxFQUFFQSxPQUFPLEVBQUVJLEtBQUssRUFBRTtZQUM5QixJQUFJQSxPQUFPO2dCQUNUSixRQUFRYixJQUFJLENBQUNTLEVBQUUsR0FBR1EsTUFBTUMsR0FBRztnQkFDM0JMLFFBQVFiLElBQUksQ0FBQ1csTUFBTSxHQUFHTSxNQUFNTixNQUFNO2dCQUNsQ0UsUUFBUWIsSUFBSSxDQUFDWSxRQUFRLEdBQUdLLE1BQU1MLFFBQVE7WUFDeEM7WUFDQSxPQUFPQztRQUNUO0lBQ0Y7SUFDQU0sT0FBTztRQUNMOUIsUUFBUTtRQUNSK0IsT0FBTztJQUNUO0FBQ0YsR0FBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTmV4dEF1dGggZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IENyZWRlbnRpYWxzIGZyb20gJ25leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHMnXG5pbXBvcnQgeyBEcml6emxlQWRhcHRlciB9IGZyb20gJ0BhdXRoL2RyaXp6bGUtYWRhcHRlcidcbmltcG9ydCB7IGRiIH0gZnJvbSAnQC9saWIvZGInXG5pbXBvcnQgeyB1c2VycyB9IGZyb20gJ0AvbGliL2RiL3NjaGVtYSdcbmltcG9ydCB7IGVxIH0gZnJvbSAnZHJpenpsZS1vcm0nXG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJ1xuXG5leHBvcnQgY29uc3QgeyBoYW5kbGVycywgc2lnbkluLCBzaWduT3V0LCBhdXRoIH0gPSBOZXh0QXV0aCh7XG4gIGFkYXB0ZXI6IERyaXp6bGVBZGFwdGVyKGRiKSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHMoe1xuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6ICdFbWFpbCcsIHR5cGU6ICdlbWFpbCcgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6ICdTZW5oYScsIHR5cGU6ICdwYXNzd29yZCcgfSxcbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzPy5wYXNzd29yZCkge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgICAud2hlcmUoZXEodXNlcnMuZW1haWwsIGNyZWRlbnRpYWxzLmVtYWlsIGFzIHN0cmluZykpXG4gICAgICAgICAgLmxpbWl0KDEpXG5cbiAgICAgICAgaWYgKCF1c2VyLmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc1ZhbGlkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShcbiAgICAgICAgICBjcmVkZW50aWFscy5wYXNzd29yZCBhcyBzdHJpbmcsXG4gICAgICAgICAgdXNlclswXS5wYXNzd29yZFxuICAgICAgICApXG5cbiAgICAgICAgaWYgKCFpc1ZhbGlkUGFzc3dvcmQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1c2VyWzBdLmlzQWN0aXZlKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaWQ6IHVzZXJbMF0uaWQsXG4gICAgICAgICAgZW1haWw6IHVzZXJbMF0uZW1haWwsXG4gICAgICAgICAgbmFtZTogdXNlclswXS5uYW1lLFxuICAgICAgICAgIGRlZ3JlZTogdXNlclswXS5kZWdyZWUsXG4gICAgICAgICAgcG9zaXRpb246IHVzZXJbMF0ucG9zaXRpb24sXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSksXG4gIF0sXG4gIHNlc3Npb246IHtcbiAgICBzdHJhdGVneTogJ2p3dCcsXG4gIH0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLmRlZ3JlZSA9IHVzZXIuZGVncmVlXG4gICAgICAgIHRva2VuLnBvc2l0aW9uID0gdXNlci5wb3NpdGlvblxuICAgICAgfVxuICAgICAgcmV0dXJuIHRva2VuXG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLnN1YiFcbiAgICAgICAgc2Vzc2lvbi51c2VyLmRlZ3JlZSA9IHRva2VuLmRlZ3JlZSBhcyBudW1iZXJcbiAgICAgICAgc2Vzc2lvbi51c2VyLnBvc2l0aW9uID0gdG9rZW4ucG9zaXRpb24gYXMgc3RyaW5nXG4gICAgICB9XG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH0sXG4gIH0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiAnL2xvZ2luJyxcbiAgICBlcnJvcjogJy9hdXRoL2Vycm9yJyxcbiAgfSxcbn0pXG4iXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJDcmVkZW50aWFscyIsIkRyaXp6bGVBZGFwdGVyIiwiZGIiLCJ1c2VycyIsImVxIiwiYmNyeXB0IiwiaGFuZGxlcnMiLCJzaWduSW4iLCJzaWduT3V0IiwiYXV0aCIsImFkYXB0ZXIiLCJwcm92aWRlcnMiLCJjcmVkZW50aWFscyIsImVtYWlsIiwibGFiZWwiLCJ0eXBlIiwicGFzc3dvcmQiLCJhdXRob3JpemUiLCJ1c2VyIiwic2VsZWN0IiwiZnJvbSIsIndoZXJlIiwibGltaXQiLCJsZW5ndGgiLCJpc1ZhbGlkUGFzc3dvcmQiLCJjb21wYXJlIiwiaXNBY3RpdmUiLCJpZCIsIm5hbWUiLCJkZWdyZWUiLCJwb3NpdGlvbiIsInNlc3Npb24iLCJzdHJhdGVneSIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwic3ViIiwicGFnZXMiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/auth.ts\n");

/***/ })

});